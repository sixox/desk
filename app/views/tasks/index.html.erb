<!-- app/views/tasks/index.html.erb -->
<div class="col-lg-10 mx-auto mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">Tasks</h4>
    <%= link_to "Leads", leads_path, class: "btn btn-sm btn-outline-secondary" %>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <%= form_with url: tasks_path, method: :get, local: true do %>
        <div class="row g-2 align-items-end">
          <div class="col-md-6">
            <label class="form-label mb-1">Assignee</label>
            <select name="assignee_id" class="form-select form-select-sm">
              <% @users.each do |u| %>
                <option value="<%= u.id %>" <%= "selected" if u.id.to_s == @assignee_id.to_s %>><%= u.name %></option>
              <% end %>
            </select>
          </div>
          <div class="col-md-6 text-end">
            <button class="btn btn-sm btn-primary">Apply</button>
            <%= link_to "Mine", tasks_path(assignee_id: current_user.id), class: "btn btn-sm btn-outline-secondary" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-md-3">
      <div class="card h-100 border-danger">
        <div class="card-header bg-danger text-white">Overdue (<%= @counts[:overdue] %>)</div>
        <div class="list-group list-group-flush">
          <% @overdue.each do |t| %>
            <%= link_to lead_path(t.lead), class: "list-group-item list-group-item-action" do %>
              <div class="d-flex justify-content-between align-items-center">
                <div class="fw-semibold"><%= t.title %></div>
                <span class="badge bg-danger"><%= l(t.due_on) %></span>
              </div>
              <div class="small text-muted">Lead: <%= t.lead.name %></div>
            <% end %>
          <% end %>
          <% if @overdue.empty? %><div class="list-group-item text-muted small">No items</div><% end %>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card h-100 border-primary">
        <div class="card-header bg-primary text-white">Today (<%= @counts[:today] %>)</div>
        <div class="list-group list-group-flush">
          <% @today.each do |t| %>
            <%= link_to lead_path(t.lead), class: "list-group-item list-group-item-action" do %>
              <div class="d-flex justify-content-between align-items-center">
                <div class="fw-semibold"><%= t.title %></div>
                <span class="badge bg-primary"><%= l(t.due_on) %></span>
              </div>
              <div class="small text-muted">Lead: <%= t.lead.name %></div>
            <% end %>
          <% end %>
          <% if @today.empty? %><div class="list-group-item text-muted small">No items</div><% end %>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card h-100 border-success">
        <div class="card-header bg-success text-white">Upcoming (<%= @counts[:upcoming] %>)</div>
        <div class="list-group list-group-flush">
          <% @upcoming.each do |t| %>
            <%= link_to lead_path(t.lead), class: "list-group-item list-group-item-action" do %>
              <div class="d-flex justify-content-between align-items-center">
                <div class="fw-semibold"><%= t.title %></div>
                <span class="badge bg-success"><%= l(t.due_on) %></span>
              </div>
              <div class="small text-muted">Lead: <%= t.lead.name %></div>
            <% end %>
          <% end %>
          <% if @upcoming.empty? %><div class="list-group-item text-muted small">No items</div><% end %>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card h-100 border-secondary">
        <div class="card-header bg-secondary text-white">No date (<%= @counts[:nodate] %>)</div>
        <div class="list-group list-group-flush">
          <% @nodate.each do |t| %>
            <%= link_to lead_path(t.lead), class: "list-group-item list-group-item-action" do %>
              <div class="fw-semibold"><%= t.title %></div>
              <div class="small text-muted">Lead: <%= t.lead.name %></div>
            <% end %>
          <% end %>
          <% if @nodate.empty? %><div class="list-group-item text-muted small">No items</div><% end %>
        </div>
      </div>
    </div>
  </div>
</div>
