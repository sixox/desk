<!-- app/views/projects/turnovers.html.erb -->
<div class="col-lg-11 mx-auto mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">Projects â€” DSO (Turnovers)</h4>
    <%= link_to "Back to Projects", projects_path, class: "btn btn-sm btn-outline-secondary" %>
  </div>

  <% if @rows.blank? %>
    <div class="alert alert-warning">No eligible projects yet (some payments are still pending or no booking).</div>
  <% end %>

  <div class="row g-3">
    <% @rows.each do |row| %>
      <div class="col-12">
        <div class="card border-0 shadow">
          <div class="card-body p-xl-4" style="background:#ced1e1;">
            <div class="card card-custom mt-2 mb-4">
              <div class="card-body">
                <div class="row d-flex justify-content-between mt-2">
                  <div class="col-auto">
                    <h6 class="fw-bold">
                      Project:
                      <span class="fw-bold text-info"><%= row.project.number %></span>
                      <span class="ms-2 small text-muted">(<%= link_to "open", project_path(row.project) %>)</span>
                    </h6>
                  </div>
                  <div class="col-auto">
                    <h6 class="card-subtitle text-secondary">
                      <span class="text-danger"><i class="bi bi-activity"></i></span>
                      <span class="timeline-small">Days Sales Outstanding</span>
                      <span class="text-danger"><i class="bi bi-activity"></i></span>
                    </h6>
                  </div>
                  <div class="col-auto">
                    <h6 class="text-success mb-0">
                      <%= number_with_precision(row.dso_days, precision: 1) %>
                      <small class="text-secondary">Days</small>
                    </h6>
                  </div>
                </div>
              </div>
            </div>

            <!-- Two-column: Payments | Swifts (same presentation you have) -->
            <div class="container">
              <div class="row">
                <div class="col-lg-6 col-12 mb-4">
                  <div class="card card-custom mt-1 h-100">
                    <div class="card-body d-flex flex-column">
                      <h3>Payments</h3>
                      <table class="table table-striped flex-grow-1">
                        <thead>
                          <tr>
                            <th>ID</th>
                            <th>Amount</th>
                            <th>Currency</th>
                            <th>Status</th>
                            <th>Date</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% row.payments_table.each do |payment| %>
                            <tr>
                              <td><%= link_to payment.id, payment_order_path(payment), class: "link-nodecor-po" %></td>
                              <td class="fw-bold"><%= number_with_precision(payment.amount.to_i, precision: 0, delimiter: ",") %></td>
                              <td><small><%= payment.currency %></small></td>
                              <td><%= payment.status %></td>
                              <td><small><%= payment.ceo_confirmed_at.present? ? payment.ceo_confirmed_at.strftime("%Y-%m-%d") : "-" %></small></td>
                            </tr>
                          <% end %>
                          <% if row.payments_table.empty? %>
                            <tr><td colspan="5" class="text-muted">No payments</td></tr>
                          <% end %>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>

                <div class="col-lg-6 col-12 mb-4">
                  <div class="card card-custom mt-1 h-100">
                    <div class="card-body d-flex flex-column">
                      <h3>Swifts</h3>
                      <table class="table table-striped flex-grow-1">
                        <thead>
                          <tr>
                            <th>ID</th>
                            <th>Amount</th>
                            <th>Currency</th>
                            <th>Status</th>
                            <th>Date</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% row.swifts_table.each do |swift| %>
                            <tr>
                              <td><%= swift.id %></td>
                              <td class="fw-bold"><%= number_with_precision(swift.amount.to_i, precision: 0, delimiter: ",") %></td>
                              <td><small><%= swift.currency %></small></td>
                              <td><%= swift.confirmed ? "Confirmed" : "-" %></td>
                              <td><small><%= swift.created_at.strftime("%Y-%m-%d") %></small></td>
                            </tr>
                          <% end %>
                          <% if row.swifts_table.empty? %>
                            <tr><td colspan="5" class="text-muted">No swifts</td></tr>
                          <% end %>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>

              </div>
            </div>

          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="mt-3">
    <%= paginate @projects_page %>
  </div>
</div>
